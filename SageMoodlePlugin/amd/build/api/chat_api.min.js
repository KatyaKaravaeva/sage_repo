/**
 * Provides an API for interacting with the chat functionality, including sending and receiving messages,
 * managing chat state, and registering listeners for chat events.
 *
 * @module     block_sage/api/chat_api
 * @copyright  2024 Vasilevskiy Vladimir <vivasilevskiy_1@edu.hse.ru>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_sage/api/chat_api",["core/ajax","block_sage/api/selection_api","block_sage/questions/request_args"],(function(Ajax,selection_api,request_args){let chatOpen=!1,curChatMessages=[],wasSynced=!1,chatStateListeners=[],chatMessageListeners=[];function syncMessagesFromServer(){var args=request_args.getAttemptFromURL();Ajax.call([{methodname:"block_sage_get_chat_messages",args:args}])[0].done((function(response){curChatMessages=[],response.messages.forEach((m=>addMessageToChat(m)))})).fail((function(error){window.console.error("Error:",error)}))}function addMessageToChat(message){curChatMessages.push(message),chatMessageListeners.forEach((listener=>listener()))}return{syncMessagesFromServer:syncMessagesFromServer,isChatOpen:function(){return chatOpen},setChatState:function(open){chatOpen=open,chatStateListeners.forEach((listener=>listener()))},getChatMessages:function(){return wasSynced||(wasSynced=!0,syncMessagesFromServer()),curChatMessages},addMessageToChat:addMessageToChat,processNewChatMessage:function(message){var args_msg=request_args.getAttemptFromURL(),args_process=request_args.getRequestWithData();if(null===args_msg||null===args_process)return void window.console.error("Error: This page does not allow chat opening");const request=Ajax.call([{methodname:"block_sage_add_chat_message",args:{...args_msg,context:selection_api.getCurrentSelection(),message:message}},{methodname:"block_sage_process_action_request",args:{...args_process,requestType:"CHAT_ANALYZE"}}]);request[0].done((function(response){addMessageToChat(response.message)})).fail((function(error){window.console.error("Error while sending the message: "+error.message)})),request[1].done((function(response){addMessageToChat(response.message)})).fail((function(error){window.console.error("Error while processing chat: "+error.message)}))},registerChatMessageListener:function(listener){chatMessageListeners.push(listener)},registerChatStateListener:function(listener){chatStateListeners.push(listener)}}}));

//# sourceMappingURL=chat_api.min.js.map