/**
 * Manages the visual representation and user interaction of the chat window, including creating, displaying,
 * and handling messages.  It also handles the chat button and context highlighting.
 *
 * @module     block_sage/render/chat
 * @copyright  2024 Vasilevskiy Vladimir <vivasilevskiy_1@edu.hse.ru>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_sage/render/chat",["jquery","block_sage/api/chat_api","block_sage/api/selection_api"],(function($,chat_api,selection_api){let sageIcon=null;function updateContextUI(){const contextElement=$(".sage-chat-context"),contextTextElement=$(".sage-context-text");selection_api.getCurrentSelection()?(contextTextElement.text(selection_api.getCurrentSelection()),contextElement.show()):contextElement.hide()}function toggleChat(){chat_api.isChatOpen()?($(".sage-chat-window").slideDown(),$(".sage-chat-button").fadeOut(),renderChat()):($(".sage-chat-window").slideUp(),$(".sage-chat-button").fadeIn())}function renderChat(){$(".sage-chat-messages").empty();const messages=chat_api.getChatMessages();for(let i=0;i<messages.length;i++){const message=messages[i];type=message.role,messageText=message.message,$(".sage-chat-messages").append('\n            <div class="sage-message">\n                <img src='.concat("SAGE"===type?sageIcon:"https://avatars.mds.yandex.net/get-yapic/0/0-0/islands-retina-middle",'\n                  alt="Avatar" class="sage-avatar">\n                <div class="sage-message-content">\n                    <strong>').concat("SAGE"===type?"Мудрец":"Вы","</strong>\n                    ").concat(messageText,"\n                </div>\n            </div>\n        "))}var type,messageText;!function(){const $messagesContainer=$(".sage-chat-messages");$messagesContainer.scrollTop($messagesContainer[0].scrollHeight)}()}function sendMessage(){const messageText=$(".sage-message-input").val();messageText.trim()&&chat_api.processNewChatMessage(messageText),$(".sage-message-input")[0].value=""}return $('<style type="text/css">').html("\n        body {\n            margin: 0;\n            padding: 0;\n            font-family: Arial, sans-serif;\n        }\n\n        .sage-chat-icon {\n            width: 50px;\n            height: 50px;\n        }\n\n        .sage-chat-button {\n            position: fixed;\n            bottom: 80px;\n            right: 0px;\n            display: flex;\n            align-items: center;\n            background-color: white;\n            border-radius: 50%;\n            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n            padding: 10px;\n            cursor: pointer;\n            transition: all 0.3s;\n            width: 70px;\n            height: 70px;\n            user-select: none;\n        }\n\n        .sage-chat-label {\n            margin-left: 10px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n\n        .sage-chat-button.expanded {\n            border-radius: 25px;\n            width: 200px;\n        }\n\n        .sage-chat-button.expanded .sage-chat-label {\n            opacity: 1;\n        }\n\n        .sage-chat-window {\n            position: fixed;\n            bottom: 80px;\n            right: 20px;\n            width: 400px;\n            background-color: #fff;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n            overflow: hidden;\n        }\n\n        .sage-chat-header {\n            background-color: #f1f1f1;\n            padding: 10px;\n            display: flex;\n            justify-content: flex-end;\n        }\n\n        .sage-chat-close {\n            border: none;\n            background: none;\n            font-size: 18px;\n            cursor: pointer;\n        }\n\n        .sage-chat-messages {\n            max-height: 600px;\n            overflow-y: auto;\n            padding: 10px;\n        }\n\n        .sage-message {\n            display: flex;\n            align-items: flex-start;\n            margin-bottom: 10px;\n        }\n\n        .sage-avatar {\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            margin-right: 10px;\n        }\n\n        .sage-message-content {\n            background-color: #f1f1f1;\n            border-radius: 10px;\n            padding: 10px;\n            max-width: 70%;\n        }\n\n        .sage-chat-input {\n            display: flex;\n            align-items: center;\n            padding: 10px;\n            background-color: #fff;\n            border-top: 1px solid #e1e1e1;\n        }\n\n        .sage-message-input {\n            flex: 1;\n            border: 1px solid #e1e1e1;\n            border-radius: 20px;\n            padding: 10px;\n            margin-right: 10px;\n        }\n\n        .sage-send-button {\n            background: none;\n            border: none;\n            cursor: pointer;\n        }\n\n        .sage-send-icon {\n          width: 20px;\n          height: 20px;\n        }\n        \n        .sage-chat-context {\n            display: flex;\n            align-items: center;\n            padding: 10px;\n            background-color: #f1f1f1;\n            border-bottom: 1px solid #e1e1e1;\n            font-size: 14px;\n        }\n        \n        .sage-context-text {\n            flex: 1;\n            margin-left: 5px;\n            color: #333;\n        }\n        \n        .sage-clear-context {\n            background: none;\n            border: none;\n            cursor: pointer;\n            font-size: 16px;\n            color: #666;\n            margin-left: 10px;\n        }\n        \n        .sage-clear-context:hover {\n            color: #000;\n        }\n        ").appendTo("head"),{init:function(){sageIcon=M.cfg.wwwroot+"/blocks/sage/pix/icon.png",$("body").append('\n            <div class="sage-chat-button">\n                <img src='.concat(sageIcon,' alt="Chat Icon" class="sage-chat-icon">\n                <span class="sage-chat-label">Посоветоваться с Мудрецом</span>\n            </div>\n        ')),$(".sage-chat-button").hide().fadeIn(),$(".sage-chat-button").on("mouseenter",(function(){window.getSelection().toString()||$(this).addClass("expanded")})).on("mouseleave",(function(){window.getSelection().toString()||$(this).removeClass("expanded")})),$(".sage-chat-button").on("click",(function(){const selectedText=window.getSelection().toString();selectedText?(selection_api.setCurrentSelection(selectedText),chat_api.setChatState(!0)):chat_api.setChatState(!0)})),document.addEventListener("selectionchange",(function(){const selectedText=window.getSelection().toString(),$button=$(".sage-chat-button"),$label=$(".sage-chat-label");selectedText?($label.text("Пояснить"),$button.addClass("expanded")):($label.text("Посоветоваться с Мудрецом"),$button.removeClass("expanded"))})),$("body").append('\n            <div class="sage-chat-window" style="display:none;">\n                <div class="sage-chat-header">\n                    <button class="sage-chat-close">></button>\n                </div>\n                <div class="sage-chat-messages"></div>\n                <div class="sage-chat-context" style="display: none;">\n                    <span>Контекст: </span>\n                    <span class="sage-context-text"></span>\n                    <button class="sage-clear-context">×</button>\n                </div>\n                <div class="sage-chat-input">\n                    <input type="text" placeholder="Введите Ваш вопрос" class="sage-message-input">\n                    <button class="sage-send-button">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" \n                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stroke-[1.5]"\n                        id="#sendbutton"><path d="M10 14l11 -11"></path><path d="M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 \n                        -3.5a.55 .55 0 0 1 0 -1l18 -6.5"></path></svg>\n                    </button>\n                </div>\n            </div>\n        '),$(".sage-chat-close").on("click",(function(){chat_api.setChatState(!1)})),$(".sage-send-button").on("click",(function(){sendMessage()})),$(".sage-message-input").on("keypress",(function(e){13===e.which&&sendMessage()})),$(".sage-clear-context").on("click",(function(){selection_api.resetSelection()})),chat_api.registerChatStateListener(toggleChat),chat_api.registerChatMessageListener(renderChat),selection_api.registerSelectionChangeListener(updateContextUI)}}}));

//# sourceMappingURL=chat.min.js.map