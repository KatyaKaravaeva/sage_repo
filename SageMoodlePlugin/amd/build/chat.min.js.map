{"version":3,"file":"chat.min.js","sources":["../src/chat.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module chat\n *\n * @module     block_sage/chat\n * @copyright  2024 YOUR NAME <your@email.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function($) {\n    var isChatOpen = false;\n\n    $('<style type=\"text/css\">')\n        .html(`\n        body {\n            margin: 0;\n            padding: 0;\n            font-family: Arial, sans-serif;\n        }\n\n        .sage-chat-icon {\n            width: 50px;\n            height: 50px;\n        }\n\n        .sage-chat-button {\n            position: fixed;\n            bottom: 80px;\n            right: 0px;\n            display: flex;\n            align-items: center;\n            background-color: white;\n            border-radius: 50%;\n            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n            padding: 10px;\n            cursor: pointer;\n            transition: all 0.3s;\n            width: 70px;\n            height: 70px;\n        }\n\n        .sage-chat-label {\n            margin-left: 10px;\n            opacity: 0;\n            transition: opacity 0.3s;\n        }\n\n        .sage-chat-button.expanded {\n            border-radius: 25px;\n            width: 200px;\n        }\n\n        .sage-chat-button.expanded .sage-chat-label {\n            opacity: 1;\n        }\n\n        .sage-chat-window {\n            position: fixed;\n            bottom: 80px;\n            right: 20px;\n            width: 300px;\n            background-color: #fff;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n            overflow: hidden;\n        }\n\n        .sage-chat-header {\n            background-color: #f1f1f1;\n            padding: 10px;\n            display: flex;\n            justify-content: flex-end;\n        }\n\n        .sage-chat-close {\n            border: none;\n            background: none;\n            font-size: 18px;\n            cursor: pointer;\n        }\n\n        .sage-chat-messages {\n            max-height: 300px;\n            overflow-y: auto;\n            padding: 10px;\n        }\n\n        .sage-message {\n            display: flex;\n            align-items: flex-start;\n            margin-bottom: 10px;\n        }\n\n        .sage-avatar {\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            margin-right: 10px;\n        }\n\n        .sage-message-content {\n            background-color: #f1f1f1;\n            border-radius: 10px;\n            padding: 10px;\n            max-width: 70%;\n        }\n\n        .sage-chat-input {\n            display: flex;\n            align-items: center;\n            padding: 10px;\n            background-color: #fff;\n            border-top: 1px solid #e1e1e1;\n        }\n\n        .sage-message-input {\n            flex: 1;\n            border: 1px solid #e1e1e1;\n            border-radius: 20px;\n            padding: 10px;\n            margin-right: 10px;\n        }\n\n        .sage-send-button {\n            background: none;\n            border: none;\n            cursor: pointer;\n        }\n\n        .sage-send-icon {\n          width: 20px;\n          height: 20px;\n        }\n        `)\n        .appendTo('head');\n\n    /**\n     * Creates the chat button that appears on the webpage.  This button, when clicked, toggles the chat window's visibility.\n     * @function\n     */\n    function createButton() {\n        $('body').append(`\n            <div class=\"sage-chat-button\">\n                <img src=`+M.cfg.wwwroot + `/blocks/sage/pix/icon.png alt=\"Chat Icon\" class=\"sage-chat-icon\">\n                <span class=\"sage-chat-label\">Посоветоваться с Мудрецом</span>\n            </div>\n        `);\n\n        $('.sage-chat-button').hide().fadeIn();\n\n        $('.sage-chat-button').on('mouseenter', function() {\n            $(this).addClass('expanded');\n        }).on('mouseleave', function() {\n            $(this).removeClass('expanded');\n        });\n\n        $('.sage-chat-button').on('click', function() {\n            toggleChat();\n        });\n    }\n\n    /**\n     * Creates the chat window which includes the header, message area, input field, and send button.\n     * @function\n     */\n    function createChat() {\n        $('body').append(`\n            <div class=\"sage-chat-window\" style=\"display:none;\">\n                <div class=\"sage-chat-header\">\n                    <button class=\"sage-chat-close\">></button>\n                </div>\n                <div class=\"sage-chat-messages\"></div>\n                <div class=\"sage-chat-input\">\n                    <input type=\"text\" placeholder=\"Введите Ваш вопрос\" class=\"sage-message-input\">\n                    <button class=\"sage-send-button\">\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" \n                        stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"stroke-[1.5]\"\n                        id=\"#sendbutton\"><path d=\"M10 14l11 -11\"></path><path d=\"M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 \n                        -3.5a.55 .55 0 0 1 0 -1l18 -6.5\"></path></svg>\n                    </button>\n                </div>\n            </div>\n        `);\n\n        $('.sage-chat-close').on('click', function() {\n            toggleChat();\n        });\n\n        $('.sage-send-button').on('click', function() {\n            sendMessage();\n        });\n\n        $('.sage-message-input').on('keypress', function(e) {\n            if (e.which === 13) {\n                sendMessage();\n            }\n        });\n    }\n\n    /**\n     * Toggles the visibility of the chat window.  If the chat is open, it closes; if it's closed, it opens.\n     * @function\n     */\n    function toggleChat() {\n        isChatOpen = !isChatOpen;\n        if (isChatOpen) {\n            $('.sage-chat-window').slideDown();\n            $('.sage-chat-button').fadeOut();\n        } else {\n            $('.sage-chat-window').slideUp();\n            $('.sage-chat-button').fadeIn();\n        }\n    }\n\n    /**\n     * Adds a message to the chat\n     * @function\n     * @param {\"sage\"|\"user\"} type Use \"sage\" to send messages as The Sage or \"user\" to send user's messages\n     * @param {string} messageText The text of the message\n     */\n    function addMessageToChat(type, messageText) {\n        $('.sage-chat-messages').append(`\n            <div class=\"sage-message\">\n                <img src=${type==\"sage\"?+M.cfg.wwwroot + \"/blocks/sage/pix/icon.png\" :\n                    \"https://avatars.mds.yandex.net/get-yapic/0/0-0/islands-retina-middle\"}\n                  alt=\"Avatar\" class=\"sage-avatar\">\n                <div class=\"sage-message-content\">\n                    <strong>${type==\"sage\"?\"Мудрец\":\"Вы\"}</strong>\n                    <p>${messageText}</p>\n                </div>\n            </div>\n        `);\n    }\n\n    /**\n     * Sends a message to the server and appends both the user's message and the server's response to the chat window.\n     * Uses AJAX to communicate with the server.\n     * @function\n     */\n    function sendMessage() {\n        const messageText = $('.sage-message-input').val();\n        if (messageText.trim()) {\n            addMessageToChat(\"user\", messageText);\n            $.ajax({\n                url: 'http://127.0.0.1:5000/question',\n                type: 'POST',\n                contentType: 'application/json',\n                data: JSON.stringify({query: messageText}),\n                success: function(data) {\n                    addMessageToChat(\"sage\", data.response);\n                },\n                error: function() {\n                    alert(\"Ошибка при отправке вопроса.\");\n                }\n            });\n\n            $('.sage-message-input').val('');\n        }\n    }\n\n    return {\n        addMessageToChat : addMessageToChat,\n\n        toggleChat : toggleChat,\n\n        init: function() {\n            window.console.log(\"Init %d\", Date.now());\n            createButton();\n            createChat();\n        }\n    };\n});\n"],"names":["define","$","isChatOpen","toggleChat","slideDown","fadeOut","slideUp","fadeIn","addMessageToChat","type","messageText","append","M","cfg","wwwroot","sendMessage","val","trim","ajax","url","contentType","data","JSON","stringify","query","success","response","error","alert","html","appendTo","init","window","console","log","Date","now","hide","on","this","addClass","removeClass","e","which"],"mappings":";;;;;;;AAsBAA,yBAAO,CAAC,WAAW,SAASC,OACpBC,YAAa,WAiMRC,cACLD,YAAcA,aAEVD,EAAE,qBAAqBG,YACvBH,EAAE,qBAAqBI,YAEvBJ,EAAE,qBAAqBK,UACvBL,EAAE,qBAAqBM,mBAUtBC,iBAAiBC,KAAMC,aAC5BT,EAAE,uBAAuBU,oFAEA,QAANF,MAAcG,EAAEC,IAAIC,QAAU,4BACrC,yNAGgB,QAANL,KAAa,SAAS,kDAC3BC,oFAWZK,oBACCL,YAAcT,EAAE,uBAAuBe,MACzCN,YAAYO,SACZT,iBAAiB,OAAQE,aACzBT,EAAEiB,KAAK,CACHC,IAAK,iCACLV,KAAM,OACNW,YAAa,mBACbC,KAAMC,KAAKC,UAAU,CAACC,MAAOd,cAC7Be,QAAS,SAASJ,MACdb,iBAAiB,OAAQa,KAAKK,WAElCC,MAAO,WACHC,MAAM,mCAId3B,EAAE,uBAAuBe,IAAI,YApPrCf,EAAE,2BACG4B,q2FAyHAC,SAAS,QA8HP,CACHtB,iBAAmBA,iBAEnBL,WAAaA,WAEb4B,KAAM,WACFC,OAAOC,QAAQC,IAAI,UAAWC,KAAKC,OA7HvCnC,EAAE,QAAQU,OAAO,0EAEEC,EAAEC,IAAIC,2LAKzBb,EAAE,qBAAqBoC,OAAO9B,SAE9BN,EAAE,qBAAqBqC,GAAG,cAAc,WACpCrC,EAAEsC,MAAMC,SAAS,eAClBF,GAAG,cAAc,WAChBrC,EAAEsC,MAAME,YAAY,eAGxBxC,EAAE,qBAAqBqC,GAAG,SAAS,WAC/BnC,gBASJF,EAAE,QAAQU,i/BAkBVV,EAAE,oBAAoBqC,GAAG,SAAS,WAC9BnC,gBAGJF,EAAE,qBAAqBqC,GAAG,SAAS,WAC/BvB,iBAGJd,EAAE,uBAAuBqC,GAAG,YAAY,SAASI,GAC7B,KAAZA,EAAEC,OACF5B"}